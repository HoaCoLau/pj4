<% layout('layouts/admin') -%>

<h1><%= title %></h1>

<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>ID</th>
            <th>Người dùng</th>
            <th>Ngày đặt</th>
            <th>Tổng tiền</th>
            <th>Trạng thái</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody>
        <% orders.forEach(order => { %>
            <tr>
                <td><%= order.id %></td>
                <td><%= order.user ? order.user.name : 'Khách (ID: ' + order.user_id + ')' %></td>
                <td><%= order.order_date.toLocaleString() %></td>
                {# Ép kiểu sang số trước khi gọi toFixed #}
                <td><%= (order && order.total_amount !== null && order.total_amount !== undefined) ? parseFloat(order.total_amount).toFixed(2) : 'N/A' %> VND</td>
                <td>
                    <span class="badge <%=
                        order.status === 'pending' ? 'bg-warning text-dark' :
                        order.status === 'processing' ? 'bg-info' :
                        order.status === 'shipped' ? 'bg-primary' :
                        order.status === 'delivered' ? 'bg-success' :
                        order.status === 'cancelled' ? 'bg-danger' :
                        order.status === 'refunded' ? 'bg-secondary' : ''
                    %>">
                        <%= order.status %>
                    </span>
                </td>
                <td>
                    <a href="/admin/orders/<%= order.id %>" class="btn btn-sm btn-info me-2"><i class="fas fa-eye"></i> Xem</a>
                    <form action="/admin/orders/delete/<%= order.id %>?_method=DELETE" method="POST" style="display:inline;">
                         <input type="hidden" name="_method" value="DELETE">
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Bạn có chắc chắn muốn xóa đơn hàng này?');"><i class="fas fa-trash-alt"></i> Xóa</button>
                    </form>
                </td>
            </tr>
        <% }); %>
    </tbody>
</table>
