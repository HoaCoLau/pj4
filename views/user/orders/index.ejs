<% layout('layouts/user') -%>

<h1><%= title %></h1>

<% if (!orders || orders.length === 0) { %>
    <div class="alert alert-info" role="alert">
        <i class="fas fa-info-circle"></i> Bạn chưa có đơn hàng nào.
    </div>
    <p><a href="/products" class="btn btn-primary"><i class="fas fa-box-open"></i> Bắt đầu mua sắm</a></p>
<% } else { %>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID Đơn hàng</th>
                <th>Ngày đặt</th>
                <th>Tổng tiền</th>
                <th>Trạng thái</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            <% orders.forEach(order => { %>
                <tr>
                    <td><%= order.id %></td>
                    <td><%= order.order_date.toLocaleString() %></td>
                    {# Ép kiểu sang số trước khi gọi toFixed #}
                    <td><%= (order && order.total_amount !== null && order.total_amount !== undefined) ? parseFloat(order.total_amount).toFixed(2) : 'N/A' %> VND</td>
                    <td>
                         <span class="badge <%=
                            order.status === 'pending' ? 'bg-warning text-dark' :
                            order.status === 'processing' ? 'bg-info' :
                            order.status === 'shipped' ? 'bg-primary' :
                            order.status === 'delivered' ? 'bg-success' :
                            order.status === 'cancelled' ? 'bg-danger' :
                            order.status === 'refunded' ? 'bg-secondary' : ''
                        %>">
                            <%= order.status %>
                        </span>
                    </td>
                    <td>
                        <a href="/user/orders/<%= order.id %>" class="btn btn-sm btn-info"><i class="fas fa-eye"></i> Chi tiết</a>
                        {# Có thể thêm nút Hủy đơn hàng nếu trạng thái cho phép #}
                         <% if (order.status === 'pending' || order.status === 'processing') { %>
                             {# Form hủy đơn hàng #}
                             {# <form action="/user/orders/cancel/<%= order.id %>?_method=PUT" method="POST" style="display:inline;">
                                 <input type="hidden" name="_method" value="PUT">
                                 <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Bạn có chắc chắn muốn hủy đơn hàng này?');"><i class="fas fa-times-circle"></i> Hủy</button>
                             </form> #}
                         <% } %>
                    </td>
                </tr>
            <% }); %>
        </tbody>
    </table>
<% } %>
