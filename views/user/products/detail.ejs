<% layout('layouts/user') -%>

<h1><%= product ? product.name : 'Chi tiết Sản phẩm' %></h1>

<div class="row">
    <div class="col-md-6">
        <img src="<%= (product && product.image_url) ? product.image_url : '/images/placeholder.png' %>" class="img-fluid rounded" alt="<%= product ? product.name : 'Sản phẩm' %>">
    </div>
    <div class="col-md-6">
        <h2><%= product ? product.name : 'Sản phẩm không tên' %></h2>
        {# Ép kiểu sang số trước khi gọi toFixed #}
        <p class="lead"><strong>Giá:</strong> <%= (product && product.price !== null && product.price !== undefined) ? parseFloat(product.price).toFixed(2) : 'N/A' %> VND</p>
         <p><strong>Danh mục:</strong> <%= (product && product.category) ? product.category.name : 'N/A' %></p>
        <p><strong>Mô tả:</strong> <%= (product && product.description) ? product.description : 'Không có mô tả.' %></p>
        <p><strong>Tồn kho:</strong> <%= (product && product.stock_quantity !== null && product.stock_quantity !== undefined) ? product.stock_quantity : 'N/A' %></p>

         <% if (user && product && product.id) { %>
             <form action="/user/cart/add" method="POST" class="d-flex align-items-center">
                 <input type="hidden" name="product_id" value="<%= product.id %>">
                 <div class="me-2">
                     <label for="quantity" class="visually-hidden">Số lượng</label>
                     <input type="number" class="form-control form-control-sm" id="quantity" name="quantity" value="1" min="1" style="width: 70px;">
                 </div>
                 <button type="submit" class="btn btn-success"><i class="fas fa-cart-plus"></i> Thêm vào giỏ hàng</button>
             </form>
         <% } else if (!user) { %>
             <p><a href="/auth/signin">Đăng nhập</a> để thêm vào giỏ hàng.</p>
         <% } %>

        <p class="mt-3"><a href="/products" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Trở về danh sách sản phẩm</a></p>
    </div>
</div>
