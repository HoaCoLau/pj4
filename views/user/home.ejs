<% layout('layouts/user') -%>

<div class="jumbotron text-center bg-light p-5 mb-4 rounded">
    <h1 class="display-4">Chào mừng đến với Your Store!</h1>
    <p class="lead">Nơi bạn tìm thấy những sản phẩm tuyệt vời.</p>
    <hr class="my-4">
    <p>Khám phá bộ sưu tập của chúng tôi ngay bây giờ!</p>
    <a class="btn btn-primary btn-lg" href="/products" role="button"><i class="fas fa-box-open"></i> Xem Sản phẩm</a>
</div>

<h2 class="mt-5 mb-4">Sản phẩm mới nhất</h2>

<div class="row">
    <% if (latestProducts && latestProducts.length > 0) { %>
        <% latestProducts.forEach(product => { %>
            <div class="col-md-3 mb-4">
                <div class="card h-100">
                    <img src="<%= (product && product.image_url) ? product.image_url : '/images/placeholder.png' %>" class="card-img-top" alt="<%= product ? product.name : 'Sản phẩm' %>">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title"><%= product ? product.name : 'Sản phẩm không tên' %></h5>
                        {# Ép kiểu sang số trước khi gọi toFixed #}
                        <p class="card-text"><%= (product && product.price !== null && product.price !== undefined) ? parseFloat(product.price).toFixed(2) : 'N/A' %> VND</p>
                        <div class="mt-auto">
                             <a href="/products/<%= product ? product.id : '#' %>" class="btn btn-primary btn-sm"><i class="fas fa-eye"></i> Chi tiết</a>
                             <% if (user && product && product.id) { %>
                                 <form action="/user/cart/add" method="POST" style="display:inline;">
                                     <input type="hidden" name="product_id" value="<%= product.id %>">
                                     <input type="hidden" name="quantity" value="1">
                                     <button type="submit" class="btn btn-success btn-sm"><i class="fas fa-cart-plus"></i> Thêm vào giỏ</button>
                                 </form>
                             <% } %>
                        </div>
                    </div>
                </div>
            </div>
        <% }); %>
    <% } else { %>
        <div class="col-12">
            <p>Không có sản phẩm mới nào.</p>
        </div>
    <% } %>
</div>

<h2 class="mt-5 mb-4">Danh mục</h2>

<div class="list-group">
    <% if (categories && categories.length > 0) { %>
        <% categories.forEach(category => { %>
            <a href="/products?categoryId=<%= category.id %>" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <i class="fas fa-tag me-2"></i> <%= category.name %>
            </a>
        <% }); %>
    <% } else { %>
         <p>Không có danh mục nào.</p>
    <% } %>
</div>
